{"version":3,"sources":["webpack://react-template-mobile/./src/modules/photo/pages/TakePhoto.tsx"],"names":["className","imageRef","useRef","base64","setBase64","useState","fileInfo","setFileInfo","name","size","url","useEffect","window","URL","revokeObjectURL","type","accept","capture","onChange","event","file","target","files","fileSize","Math","round","toFixed","createObjectURL","reader2","FileReader","readAsArrayBuffer","onload","e","result","ArrayBuffer","Blob","reader","readAsDataURL","onloadend","ref","src","alt","style","width","margin","onClick","document","createElement","filename","eleLink","download","display","href","body","appendChild","click","removeChild","funDownload","alert"],"mappings":";kNAqFQ,YAAMA,UAAU,oBAAhB,OAhFR,MA+FA,EA/Fc,KACZ,MAAMC,GAAWC,YAAyB,OACnCC,EAAQC,IAAaC,cAAS,KAC9BC,EAAUC,IAAeF,cAAsD,CACpFG,KAAM,GACNC,KAAM,GACNC,IAAK,MAGPC,gBACE,IAAM,KACJC,OAAOC,IAAIC,gBAAgBR,EAASI,OAEtC,CAACJ,EAASI,MAgEZ,OACE,eAAS,UAAU,6DAAnB,EACE,WAAKV,UAAU,mBAAf,IAEE,aAAOA,UAAU,QAAQe,KAAK,OAAOC,OAAO,UAAUC,QAAQ,OAAOC,SAjEzDC,IAA+C,MAC/D,MAAMC,EAAI,UAAGD,EAAME,OAAOC,aAAhB,aAAG,EAAqB,GAClC,GAAIF,EAAM,CAER,MAAMG,EAAWC,KAAKC,MAAML,EAAKX,KAAO,MAAMiB,QAAQ,GAChDhB,EAAME,OAAOC,IAAIc,gBAAgBP,GACvCb,EAAY,CAAEC,KAAMY,EAAKZ,KAAMC,KAAMc,EAAUb,QAU/C,MAAMkB,EAAU,IAAIC,WACpBD,EAAQE,kBAAkBV,GAC1BQ,EAAQG,OAASC,IAAK,MACpB,MAAMC,EAAM,UAAGD,EAAEX,cAAL,aAAG,EAAUY,OACzB,GAAIA,aAAkBC,YAAa,CACpB,IAAIC,KAAK,CAACF,MAM3B,MAAMG,EAAS,IAAIP,WACnBO,EAAOC,cAAcjB,GACrBgB,EAAOE,UAAY,KACjB,MAAMnC,EAASiC,EAAOH,OACA,kBAAX9B,GACTC,EAAUD,SAmCd,WAAKH,UAAU,cAAf,EAAwBM,EAASI,KAAO,uBAAK6B,IAAKtC,EAAUuC,IAAKlC,EAASI,KAAOP,EAAQsC,IAAI,MAC7F,WAAKC,MAAO,CAAEC,MAAO,OAAQC,OAAQ,gBAArC,EACGtC,EAASI,KACR,SAAQK,KAAK,UAAU8B,QAjBT,KAChB,aAAcC,SAASC,cAAc,KAdvB,EAACrC,EAAasC,KAChC,MAAMC,EAAUH,SAASC,cAAc,KACvCE,EAAQC,SAAWF,EACnBC,EAAQP,MAAMS,QAAU,OACxBF,EAAQG,KAAO1C,EAEfoC,SAASO,KAAKC,YAAYL,GAC1BA,EAAQM,QAERT,SAASO,KAAKG,YAAYP,IAMxBQ,CAAYnD,EAASI,IAAKJ,EAASE,MAEnCI,OAAO8C,MAAM,kBAaT","file":"static/js/413.ee11d5f1.chunk.js","sourcesContent":["import { Button } from 'antd-mobile';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport '../style/take-photo.less';\n\nconst Regex = () => {\n  const imageRef = useRef<HTMLImageElement>(null);\n  const [base64, setBase64] = useState('');\n  const [fileInfo, setFileInfo] = useState<{ name: string; size: string; url: string }>({\n    name: '',\n    size: '',\n    url: ''\n  });\n\n  useEffect(\n    () => () => {\n      window.URL.revokeObjectURL(fileInfo.url);\n    },\n    [fileInfo.url]\n  );\n\n  const onChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      console.dir(file);\n      const fileSize = Math.round(file.size / 1024).toFixed(2); // KB\n      const url = window.URL.createObjectURL(file);\n      setFileInfo({ name: file.name, size: fileSize, url });\n\n      // 转bold 方法一\n      // void fetch(url)\n      //   .then(res => res.blob())\n      //   .then(blod => {\n      //     console.log('blod= ', blod);\n      //   });\n\n      // 转bold 方法二\n      const reader2 = new FileReader();\n      reader2.readAsArrayBuffer(file);\n      reader2.onload = e => {\n        const result = e.target?.result;\n        if (result instanceof ArrayBuffer) {\n          const blob = new Blob([result]);\n          console.log('blob=', blob);\n        }\n      };\n\n      // 转 base64\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n      reader.onloadend = () => {\n        const base64 = reader.result;\n        if (typeof base64 === 'string') {\n          setBase64(base64);\n          console.log(base64);\n        }\n      };\n    }\n  };\n\n  // 下载文件方法\n  const funDownload = (url: string, filename: string) => {\n    const eleLink = document.createElement('a');\n    eleLink.download = filename;\n    eleLink.style.display = 'none';\n    eleLink.href = url;\n    // 触发点击\n    document.body.appendChild(eleLink);\n    eleLink.click();\n    // 然后移除\n    document.body.removeChild(eleLink);\n  };\n\n  // 下载\n  const onDownLoadImg = () => {\n    if ('download' in document.createElement('a')) {\n      funDownload(fileInfo.url, fileInfo.name);\n    } else {\n      window.alert('浏览器不支持！');\n    }\n  };\n\n  return (\n    <section styleName=\"take-photo\">\n      <div className=\"input-wrap\">\n        <span className=\"input-inner\">+</span>\n        <input className=\"input\" type=\"file\" accept=\"image/*\" capture=\"user\" onChange={onChange} />\n      </div>\n      <div className=\"image\">{fileInfo.url && <img ref={imageRef} src={fileInfo.url || base64} alt=\"\" />}</div>\n      <div style={{ width: '100%', margin: '10px 0' }}>\n        {fileInfo.url && (\n          <Button type=\"primary\" onClick={onDownLoadImg}>\n            下载图片\n          </Button>\n        )}\n      </div>\n    </section>\n  );\n};\n\nexport default Regex;\n"],"sourceRoot":""}